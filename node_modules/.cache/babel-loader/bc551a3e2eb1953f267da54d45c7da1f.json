{"ast":null,"code":"import _objectSpread from\"/home/kali/demo/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/kali/demo/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/home/kali/demo/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/kali/demo/node_modules/@babel/runtime/helpers/esm/createClass\";import _createSuper from\"/home/kali/demo/node_modules/@babel/runtime/helpers/esm/createSuper\";import _inherits from\"/home/kali/demo/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import{connect}from'react-redux';import moment from'moment';import{FaCircleNotch,FaCaretDown,FaCaretUp,FaCaretRight,FaSync}from'react-icons/fa';import selectCoins from'../selectors/coins';import{setCoins as _setCoins}from'../actions/coins';import{updatePriceInfo as _updatePriceInfo}from'../actions/price-info';import{setTextFilter as _setTextFilter,sortByNameAsc as _sortByNameAsc,sortByNameDesc as _sortByNameDesc,sortByMktCapAsc as _sortByMktCapAsc,sortByMktCapDesc as _sortByMktCapDesc,sortByPriceAsc as _sortByPriceAsc,sortByPriceDesc as _sortByPriceDesc,sortByChangeAsc as _sortByChangeAsc,sortByChangeDesc as _sortByChangeDesc}from'../actions/filters';import CoinTile from'./CoinTile';import Scroller from'./Scroller';var cc=require('cryptocompare');cc.setApiKey(process.env.REACT_APP_CRYPTO_COMPARE_API_KEY);var CoinIndexPage=/*#__PURE__*/function(_React$Component){_inherits(CoinIndexPage,_React$Component);var _super=_createSuper(CoinIndexPage);function CoinIndexPage(){var _this;_classCallCheck(this,CoinIndexPage);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={sort:''};_this.componentDidMount=function(){if(!_this.props.priceInfo.all&&_this.props.coins.length>0){_this.fetchCoins();}_this._ismounted=true;};_this.componentDidUpdate=function(){if(!_this.props.priceInfo.all&&_this.props.coins.length>0){_this.fetchCoins();}};_this.updatePrices=function(){document.getElementById('refresh-prices-icon').classList.add('fa-spin');_this.fetchCoins();};_this.fetchCoins=function(){var coins=_this.props.coins;var coinKeys=[];for(var i=0;i<coins.length;i++){coinKeys.push(coins[i].symbol);}_this.fetchPrices([],[],[].concat(coinKeys),_toConsumableArray(coins),100,'USD');};_this.fetchPrices=function(processedKeys,processedCoins,remainingKeys,remainingData,spliceSize,currency){var keysSplice=remainingKeys.splice(0,spliceSize);var dataSplice=remainingData.splice(0,spliceSize);console.log(keysSplice);cc.priceFull(keysSplice,[currency]).then(function(prices){for(var i=0;i<keysSplice.length;i++){var price=null,changeDay=null,changePctDay=null,mktCap=null,imgUrl=null,totalVol24hr=null,supply=null,high24hr=null,low24hr=null;if(prices[keysSplice[i]]){price=prices[keysSplice[i]][currency].PRICE;changeDay=prices[keysSplice[i]][currency].CHANGEDAY;changePctDay=prices[keysSplice[i]][currency].CHANGEPCTDAY;mktCap=prices[keysSplice[i]][currency].MKTCAP;totalVol24hr=prices[keysSplice[i]][currency].VOLUMEDAY;supply=prices[keysSplice[i]][currency].SUPPLY;high24hr=prices[keysSplice[i]][currency].HIGH24HOUR;low24hr=prices[keysSplice[i]][currency].LOW24HOUR;}else{price=0;changeDay=0;changePctDay=0;mktCap=0;totalVol24hr=0;supply=0;high24hr=0;low24hr=0;}dataSplice[i]=_objectSpread({},dataSplice[i],{price:price,changeDay:changeDay,changePctDay:changePctDay,mktCap:mktCap,totalVol24hr:totalVol24hr,supply:supply,high24hr:high24hr,low24hr:low24hr,imgUrl:imgUrl});}processedKeys=processedKeys.concat(keysSplice);processedCoins=processedCoins.concat(dataSplice);if(remainingData.length>0){_this.fetchPrices(processedKeys,processedCoins,remainingKeys,remainingData,spliceSize,currency);}else{_this.props.setCoins(processedCoins);_this.props.sortByMktCapDesc();_this.props.updatePriceInfo({all:true,allLastUpdated:moment().valueOf()});if(_this._ismounted){_this.setState(function(){return{pricesLoaded:true,sort:'mktCapDesc'};});document.getElementById('refresh-prices-icon').classList.remove('fa-spin');}return;}}).catch(console.error);};_this.handleTextChange=function(e){_this.props.setTextFilter(e.target.value);};_this.handleNameSort=function(){if(_this.state.sort==='nameAsc'){_this.props.sortByNameDesc();_this.setState(function(){return{sort:'nameDesc'};});}else{_this.props.sortByNameAsc();_this.setState(function(){return{sort:'nameAsc'};});}};_this.handlePriceSort=function(){if(_this.state.sort==='priceDesc'){_this.props.sortByPriceAsc();_this.setState(function(){return{sort:'priceAsc'};});}else{_this.props.sortByPriceDesc();_this.setState(function(){return{sort:'priceDesc'};});}};_this.handleChangeSort=function(){if(_this.state.sort==='changeDesc'){_this.props.sortByChangeAsc();_this.setState(function(){return{sort:'changeAsc'};});}else{_this.props.sortByChangeDesc();_this.setState(function(){return{sort:'changeDesc'};});}};_this.handleMktCapSort=function(){if(_this.state.sort==='mktCapDesc'){_this.props.sortByMktCapAsc();_this.setState(function(){return{sort:'mktCapAsc'};});}else{_this.props.sortByMktCapDesc();_this.setState(function(){return{sort:'mktCapDesc'};});}};return _this;}_createClass(CoinIndexPage,[{key:\"componentWillUnmount\",value:function componentWillUnmount(){this._ismounted=false;this.props.setTextFilter('');}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",{className:\"content-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"index-header\"},/*#__PURE__*/React.createElement(\"input\",{type:\"text\",className:\"text-input\",placeholder:\"Search coins\",value:this.props.filters.text,onChange:this.handleTextChange}),/*#__PURE__*/React.createElement(\"div\",{className:\"updater\"},/*#__PURE__*/React.createElement(\"div\",{className:\"updater__last-updated\"},\"Last Updated:\",/*#__PURE__*/React.createElement(\"span\",{className:\"updater__time\"},this.props.priceInfo.allLastUpdated&&moment(this.props.priceInfo.allLastUpdated).format('HH:mm'))),/*#__PURE__*/React.createElement(\"button\",{type:\"button\",className:\"updater__button\",onClick:this.updatePrices},/*#__PURE__*/React.createElement(FaSync,{size:\"1rem\",id:\"refresh-prices-icon\"}),\"Refresh Prices\"))),/*#__PURE__*/React.createElement(\"div\",{id:\"coin-list\",className:\"index\"},/*#__PURE__*/React.createElement(\"div\",{className:\"table-header show-for-desktop\"},/*#__PURE__*/React.createElement(\"div\",{className:\"text-center\"},\"#\"),/*#__PURE__*/React.createElement(\"div\",{className:\"table_header__sort\",onClick:this.handleNameSort},this.state.sort==='nameAsc'?/*#__PURE__*/React.createElement(FaCaretUp,{size:\"1.8rem\"}):this.state.sort==='nameDesc'?/*#__PURE__*/React.createElement(FaCaretDown,{size:\"1.8rem\"}):/*#__PURE__*/React.createElement(FaCaretRight,{size:\"1.8rem\"}),\"Coin\"),/*#__PURE__*/React.createElement(\"div\",{className:\"table_header__sort table_header__sort--right\",onClick:this.handlePriceSort},this.state.sort==='priceAsc'?/*#__PURE__*/React.createElement(FaCaretUp,{size:\"1.8rem\"}):this.state.sort==='priceDesc'?/*#__PURE__*/React.createElement(FaCaretDown,{size:\"1.8rem\"}):/*#__PURE__*/React.createElement(FaCaretRight,{size:\"1.8rem\"}),\"Price\"),/*#__PURE__*/React.createElement(\"div\",{className:\"table_header__sort table_header__sort--right\",onClick:this.handleChangeSort},this.state.sort==='changeAsc'?/*#__PURE__*/React.createElement(FaCaretUp,{size:\"1.8rem\"}):this.state.sort==='changeDesc'?/*#__PURE__*/React.createElement(FaCaretDown,{size:\"1.8rem\"}):/*#__PURE__*/React.createElement(FaCaretRight,{size:\"1.8rem\"}),\"Change\"),/*#__PURE__*/React.createElement(\"div\",{className:\"table_header__sort table_header__sort--right\",onClick:this.handleMktCapSort},this.state.sort==='mktCapAsc'?/*#__PURE__*/React.createElement(FaCaretUp,{size:\"1.8rem\"}):this.state.sort==='mktCapDesc'?/*#__PURE__*/React.createElement(FaCaretDown,{size:\"1.8rem\"}):/*#__PURE__*/React.createElement(FaCaretRight,{size:\"1.8rem\"}),\"Market Cap\")),this.props.coins.length===0||!this.props.priceInfo.all?/*#__PURE__*/React.createElement(\"div\",{className:\"loading__notificaton\"},\"Loading coin data\",/*#__PURE__*/React.createElement(FaCircleNotch,{size:\"2.4rem\",className:\"fa-spin\"})):(this.props.visibleCoins&&this.props.visibleCoins.length)>0?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Scroller,{sliceSize:\"25\"},this.props.visibleCoins.map(function(coin,i){return/*#__PURE__*/React.createElement(CoinTile,{key:coin.symbol,type:'full',index:i,coin:coin});}))):/*#__PURE__*/React.createElement(\"div\",{className:\"loading__notificaton\"},\"No coins found\")));}}]);return CoinIndexPage;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{coins:state.coins,visibleCoins:selectCoins(state.coins,state.filters),favorites:state.favorites,filters:state.filters,priceInfo:state.priceInfo};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{setCoins:function setCoins(coins){return dispatch(_setCoins(coins));},updatePriceInfo:function updatePriceInfo(lastUpdated){return dispatch(_updatePriceInfo(lastUpdated));},setTextFilter:function setTextFilter(text){return dispatch(_setTextFilter(text));},sortByNameAsc:function sortByNameAsc(){return dispatch(_sortByNameAsc());},sortByNameDesc:function sortByNameDesc(){return dispatch(_sortByNameDesc());},sortByMktCapAsc:function sortByMktCapAsc(){return dispatch(_sortByMktCapAsc());},sortByMktCapDesc:function sortByMktCapDesc(){return dispatch(_sortByMktCapDesc());},sortByPriceAsc:function sortByPriceAsc(){return dispatch(_sortByPriceAsc());},sortByPriceDesc:function sortByPriceDesc(){return dispatch(_sortByPriceDesc());},sortByChangeAsc:function sortByChangeAsc(){return dispatch(_sortByChangeAsc());},sortByChangeDesc:function sortByChangeDesc(){return dispatch(_sortByChangeDesc());}};};export default connect(mapStateToProps,mapDispatchToProps)(CoinIndexPage);","map":{"version":3,"sources":["/home/kali/demo/src/components/CoinIndexPage.js"],"names":["React","connect","moment","FaCircleNotch","FaCaretDown","FaCaretUp","FaCaretRight","FaSync","selectCoins","setCoins","updatePriceInfo","setTextFilter","sortByNameAsc","sortByNameDesc","sortByMktCapAsc","sortByMktCapDesc","sortByPriceAsc","sortByPriceDesc","sortByChangeAsc","sortByChangeDesc","CoinTile","Scroller","cc","require","setApiKey","process","env","REACT_APP_CRYPTO_COMPARE_API_KEY","CoinIndexPage","state","sort","componentDidMount","props","priceInfo","all","coins","length","fetchCoins","_ismounted","componentDidUpdate","updatePrices","document","getElementById","classList","add","coinKeys","i","push","symbol","fetchPrices","processedKeys","processedCoins","remainingKeys","remainingData","spliceSize","currency","keysSplice","splice","dataSplice","console","log","priceFull","then","prices","price","changeDay","changePctDay","mktCap","imgUrl","totalVol24hr","supply","high24hr","low24hr","PRICE","CHANGEDAY","CHANGEPCTDAY","MKTCAP","VOLUMEDAY","SUPPLY","HIGH24HOUR","LOW24HOUR","concat","allLastUpdated","valueOf","setState","pricesLoaded","remove","catch","error","handleTextChange","e","target","value","handleNameSort","handlePriceSort","handleChangeSort","handleMktCapSort","filters","text","format","visibleCoins","map","coin","Component","mapStateToProps","favorites","mapDispatchToProps","dispatch","lastUpdated"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { connect } from 'react-redux'\nimport moment from 'moment'\nimport { FaCircleNotch, FaCaretDown, FaCaretUp, FaCaretRight, FaSync } from 'react-icons/fa'\nimport selectCoins from '../selectors/coins'\nimport { setCoins } from '../actions/coins'\nimport { updatePriceInfo } from '../actions/price-info'\nimport {\n  setTextFilter,\n  sortByNameAsc,\n  sortByNameDesc,\n  sortByMktCapAsc,\n  sortByMktCapDesc,\n  sortByPriceAsc,\n  sortByPriceDesc,\n  sortByChangeAsc,\n  sortByChangeDesc\n} from '../actions/filters'\nimport CoinTile from './CoinTile'\nimport Scroller from './Scroller'\n\nconst cc = require('cryptocompare')\ncc.setApiKey(process.env.REACT_APP_CRYPTO_COMPARE_API_KEY)\n\nclass CoinIndexPage extends React.Component {\n  state = {\n    sort: ''\n  }\n  componentDidMount = () => {\n    if(!this.props.priceInfo.all && this.props.coins.length > 0) {\n      this.fetchCoins()\n    }\n    this._ismounted = true;\n  }\n  componentDidUpdate = () => {\n    if(!this.props.priceInfo.all && this.props.coins.length > 0) {\n      this.fetchCoins()\n    }\n  }\n  componentWillUnmount() {\n     this._ismounted = false;\n     this.props.setTextFilter('')\n  }\n  updatePrices = () => {\n    document.getElementById('refresh-prices-icon').classList.add('fa-spin')\n    this.fetchCoins()\n  }\n  fetchCoins = () => {\n    const coins = this.props.coins\n    const coinKeys = []\n    for(let i = 0; i < coins.length; i++) {\n      coinKeys.push(coins[i].symbol)\n    }\n    this.fetchPrices([], [], [...coinKeys], [...coins], 100, 'USD')\n  }\n  fetchPrices = (processedKeys, processedCoins, remainingKeys, remainingData, spliceSize, currency) => {\n    const keysSplice = remainingKeys.splice(0,spliceSize)\n    const dataSplice = remainingData.splice(0,spliceSize)\n    console.log(keysSplice)\n    \n    cc.priceFull(keysSplice, [currency]).then((prices) => {\n      for(let i = 0; i < keysSplice.length; i++) {\n        let price = null, changeDay = null, changePctDay = null, mktCap = null, imgUrl = null, totalVol24hr = null, supply = null, high24hr = null, low24hr = null;\n        if(prices[keysSplice[i]]) {\n          price = prices[keysSplice[i]][currency].PRICE\n          changeDay = prices[keysSplice[i]][currency].CHANGEDAY\n          changePctDay = prices[keysSplice[i]][currency].CHANGEPCTDAY\n          mktCap = prices[keysSplice[i]][currency].MKTCAP\n          totalVol24hr = prices[keysSplice[i]][currency].VOLUMEDAY\n          supply = prices[keysSplice[i]][currency].SUPPLY\n          high24hr = prices[keysSplice[i]][currency].HIGH24HOUR\n          low24hr = prices[keysSplice[i]][currency].LOW24HOUR\n        } else {\n          price = 0\n          changeDay = 0\n          changePctDay = 0\n          mktCap = 0\n          totalVol24hr = 0\n          supply = 0\n          high24hr = 0\n          low24hr = 0\n        }\n        dataSplice[i] = {\n          ...dataSplice[i],\n          price,\n          changeDay,\n          changePctDay,\n          mktCap,\n          totalVol24hr,\n          supply,\n          high24hr,\n          low24hr,\n          imgUrl\n        }\n      }\n      processedKeys = processedKeys.concat(keysSplice)\n      processedCoins = processedCoins.concat(dataSplice)\n      if(remainingData.length > 0) {\n        this.fetchPrices(processedKeys, processedCoins, remainingKeys, remainingData, spliceSize, currency)\n      } else {\n        this.props.setCoins(processedCoins)\n        this.props.sortByMktCapDesc()\n        this.props.updatePriceInfo({\n          all: true,\n          allLastUpdated: moment().valueOf()\n        })\n        if (this._ismounted) {\n          this.setState(() => ({\n            pricesLoaded: true,\n            sort: 'mktCapDesc'\n          }))\n          document.getElementById('refresh-prices-icon').classList.remove('fa-spin')\n        }\n        return\n      }\n        \n    }).catch(console.error)\n  }\n  handleTextChange = (e) => {\n    this.props.setTextFilter(e.target.value)\n  }\n  handleNameSort = () => {\n    if(this.state.sort === 'nameAsc') {\n      this.props.sortByNameDesc()\n      this.setState(() => ({ sort: 'nameDesc' }))\n    } else {\n      this.props.sortByNameAsc()\n      this.setState(() => ({ sort: 'nameAsc' }))\n    }\n  }\n  handlePriceSort = () => {\n    if(this.state.sort === 'priceDesc') {\n      this.props.sortByPriceAsc()\n      this.setState(() => ({ sort: 'priceAsc' }))\n    } else {\n      this.props.sortByPriceDesc()\n      this.setState(() => ({ sort: 'priceDesc' }))\n    }\n  }\n  handleChangeSort = () => {\n    if(this.state.sort === 'changeDesc') {\n      this.props.sortByChangeAsc()\n      this.setState(() => ({ sort: 'changeAsc' }))\n    } else {\n      this.props.sortByChangeDesc()\n      this.setState(() => ({ sort: 'changeDesc' }))\n    }\n  }\n  handleMktCapSort = () => {\n    if(this.state.sort === 'mktCapDesc') {\n      this.props.sortByMktCapAsc()\n      this.setState(() => ({ sort: 'mktCapAsc' }))\n    } else {\n      this.props.sortByMktCapDesc()\n      this.setState(() => ({ sort: 'mktCapDesc' }))\n    }\n  }\n  render() {\n    return (\n      <div className=\"content-container\">\n        <div className=\"index-header\">\n\n        {/* LOAD CURRENT TEXT FILTER INTO SEARCH BAR WHEN RETURNING TO PAGE */}\n\n          <input type=\"text\" className=\"text-input\" placeholder=\"Search coins\" value={this.props.filters.text} onChange={this.handleTextChange} />\n          <div className=\"updater\">\n            <div className=\"updater__last-updated\">\n              Last Updated:\n              <span className=\"updater__time\">\n                {this.props.priceInfo.allLastUpdated && moment(this.props.priceInfo.allLastUpdated).format('HH:mm')}\n              </span>\n            </div>\n            <button\n              type=\"button\"\n              className=\"updater__button\"\n              onClick={this.updatePrices}\n            >\n              <FaSync size=\"1rem\" id=\"refresh-prices-icon\" />Refresh Prices\n            </button>\n          </div>\n        </div>\n        <div id=\"coin-list\" className=\"index\">\n          <div className=\"table-header show-for-desktop\">\n            <div className=\"text-center\">#</div>\n            <div className=\"table_header__sort\" onClick={this.handleNameSort}>\n              {this.state.sort === 'nameAsc' ? (\n                <FaCaretUp size=\"1.8rem\" />\n              ) : (\n                this.state.sort === 'nameDesc' ? (\n                  <FaCaretDown size=\"1.8rem\" />\n                ) : (\n                  <FaCaretRight size=\"1.8rem\" />\n                )\n              )}\n              Coin\n            </div>\n            <div className=\"table_header__sort table_header__sort--right\" onClick={this.handlePriceSort}>\n              {this.state.sort === 'priceAsc' ? (\n                <FaCaretUp size=\"1.8rem\" />\n              ) : (\n                this.state.sort === 'priceDesc' ? (\n                  <FaCaretDown size=\"1.8rem\" />\n                ) : (\n                  <FaCaretRight size=\"1.8rem\" />\n                )\n              )}\n              Price\n            </div>\n            <div className=\"table_header__sort table_header__sort--right\" onClick={this.handleChangeSort}>\n              {this.state.sort === 'changeAsc' ? (\n                <FaCaretUp size=\"1.8rem\" />\n              ) : (\n                this.state.sort === 'changeDesc' ? (\n                  <FaCaretDown size=\"1.8rem\" />\n                ) : (\n                  <FaCaretRight size=\"1.8rem\" />\n                )\n              )}\n              Change\n            </div>\n            <div className=\"table_header__sort table_header__sort--right\" onClick={this.handleMktCapSort}>\n              {this.state.sort === 'mktCapAsc' ? (\n                <FaCaretUp size=\"1.8rem\" />\n              ) : (\n                this.state.sort === 'mktCapDesc' ? (\n                  <FaCaretDown size=\"1.8rem\" />\n                ) : (\n                  <FaCaretRight size=\"1.8rem\" />\n                )\n              )}\n              Market Cap\n            </div>\n          </div>\n          {(this.props.coins.length === 0 || !this.props.priceInfo.all) ? (\n            <div className=\"loading__notificaton\">Loading coin data<FaCircleNotch size=\"2.4rem\" className=\"fa-spin\" /></div>\n          ) : (this.props.visibleCoins && this.props.visibleCoins.length) > 0 ? (\n            <>\n              <Scroller sliceSize=\"25\" >\n                {\n                this.props.visibleCoins\n                  .map((coin, i) => (\n                    <CoinTile key={coin.symbol} type={'full'} index={i} coin={coin} />\n                  ))\n                }\n              </Scroller>\n            </>\n          ) : (\n            <div className=\"loading__notificaton\">No coins found</div>\n          )}\n        </div>\n      </div>\n    )\n  }\n}\n\nconst mapStateToProps = (state) => ({\n  coins: state.coins,\n  visibleCoins: selectCoins(state.coins, state.filters),\n  favorites: state.favorites,\n  filters: state.filters,\n  priceInfo: state.priceInfo\n})\n\nconst mapDispatchToProps = (dispatch) => ({\n  setCoins: (coins) => dispatch(setCoins(coins)),\n  updatePriceInfo: (lastUpdated) => dispatch(updatePriceInfo(lastUpdated)),\n  setTextFilter: (text) => dispatch(setTextFilter(text)),\n  sortByNameAsc: () => dispatch(sortByNameAsc()),\n  sortByNameDesc: () => dispatch(sortByNameDesc()),\n  sortByMktCapAsc: () => dispatch(sortByMktCapAsc()),\n  sortByMktCapDesc: () => dispatch(sortByMktCapDesc()),\n  sortByPriceAsc: () => dispatch(sortByPriceAsc()),\n  sortByPriceDesc: () => dispatch(sortByPriceDesc()),\n  sortByChangeAsc: () => dispatch(sortByChangeAsc()),\n  sortByChangeDesc: () => dispatch(sortByChangeDesc())\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CoinIndexPage)\n"]},"metadata":{},"sourceType":"module"}